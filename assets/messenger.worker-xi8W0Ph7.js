var g;function k(e){return{lang:g?.lang,message:e?.message,abortEarly:g?.abortEarly,abortPipeEarly:g?.abortPipeEarly}}var M;function O(e){return M?.get(e)}var j;function x(e){return j?.get(e)}var C;function N(e,r){return C?.get(e)?.get(r)}function T(e){const r=typeof e;return r==="string"?`"${e}"`:r==="number"||r==="bigint"||r==="boolean"?`${e}`:r==="object"||r==="function"?(e&&Object.getPrototypeOf(e)?.constructor?.name)??"null":r}function f(e,r,t,s,n){const u=n&&"input"in n?n.input:t.value,a=n?.expected??e.expects??null,o=n?.received??T(u),i={kind:e.kind,type:e.type,input:u,expected:a,received:o,message:`Invalid ${r}: ${a?`Expected ${a} but r`:"R"}eceived ${o}`,requirement:e.requirement,path:n?.path,issues:n?.issues,lang:s.lang,abortEarly:s.abortEarly,abortPipeEarly:s.abortPipeEarly},l=e.kind==="schema",c=n?.message??e.message??N(e.reference,i.lang)??(l?x(i.lang):null)??s.message??O(i.lang);c!==void 0&&(i.message=typeof c=="function"?c(i):c),l&&(t.typed=!1),t.issues?t.issues.push(i):t.issues=[i]}function p(e){return{version:1,vendor:"valibot",validate(r){return e["~run"]({value:r},k())}}}function q(e,r,t){return typeof e.fallback=="function"?e.fallback(r,t):e.fallback}function G(e,r,t){return typeof e.default=="function"?e.default(r,t):e.default}function P(){return{kind:"schema",type:"any",reference:P,expects:"any",async:!1,get"~standard"(){return p(this)},"~run"(e){return e.typed=!0,e}}}function E(e,r){return{kind:"schema",type:"array",reference:E,expects:"Array",async:!1,item:e,message:r,get"~standard"(){return p(this)},"~run"(t,s){const n=t.value;if(Array.isArray(n)){t.typed=!0,t.value=[];for(let u=0;u<n.length;u++){const a=n[u],o=this.item["~run"]({value:a},s);if(o.issues){const i={type:"array",origin:"value",input:n,key:u,value:a};for(const l of o.issues)l.path?l.path.unshift(i):l.path=[i],t.issues?.push(l);if(t.issues||(t.issues=o.issues),s.abortEarly){t.typed=!1;break}}o.typed||(t.typed=!1),t.value.push(o.value)}}else f(this,"type",t,s);return t}}}function _(e){return{kind:"schema",type:"boolean",reference:_,expects:"boolean",async:!1,message:e,get"~standard"(){return p(this)},"~run"(r,t){return typeof r.value=="boolean"?r.typed=!0:f(this,"type",r,t),r}}}function v(e){return{kind:"schema",type:"number",reference:v,expects:"number",async:!1,message:e,get"~standard"(){return p(this)},"~run"(r,t){return typeof r.value=="number"&&!isNaN(r.value)?r.typed=!0:f(this,"type",r,t),r}}}function y(e,r){return{kind:"schema",type:"object",reference:y,expects:"Object",async:!1,entries:e,message:r,get"~standard"(){return p(this)},"~run"(t,s){const n=t.value;if(n&&typeof n=="object"){t.typed=!0,t.value={};for(const u in this.entries){const a=this.entries[u];if(u in n||(a.type==="exact_optional"||a.type==="optional"||a.type==="nullish")&&a.default!==void 0){const o=u in n?n[u]:G(a),i=a["~run"]({value:o},s);if(i.issues){const l={type:"object",origin:"value",input:n,key:u,value:o};for(const c of i.issues)c.path?c.path.unshift(l):c.path=[l],t.issues?.push(c);if(t.issues||(t.issues=i.issues),s.abortEarly){t.typed=!1;break}}i.typed||(t.typed=!1),t.value[u]=i.value}else if(a.fallback!==void 0)t.value[u]=q(a);else if(a.type!=="exact_optional"&&a.type!=="optional"&&a.type!=="nullish"&&(f(this,"key",t,s,{input:void 0,expected:`"${u}"`,path:[{type:"object",origin:"key",input:n,key:u,value:n[u]}]}),s.abortEarly))break}}else f(this,"type",t,s);return t}}}function w(e){return{kind:"schema",type:"string",reference:w,expects:"string",async:!1,message:e,get"~standard"(){return p(this)},"~run"(r,t){return typeof r.value=="string"?r.typed=!0:f(this,"type",r,t),r}}}function h(){return{kind:"schema",type:"unknown",reference:h,expects:"unknown",async:!1,get"~standard"(){return p(this)},"~run"(e){return e.typed=!0,e}}}function D(e,r,t){const s=e["~run"]({value:r},k(t));return{typed:s.typed,success:!s.issues,output:s.value,issues:s.issues}}function d(e,r){return{validate:t=>D(e,t).success,create:r}}function I(e,r,t){const s=r.reduce((n,u)=>n?.[u],e);if(typeof s!="function")throw new Error(`Topics did not resolve to a function: [${r.join(",")}]`);return s(...t)}var b="RPC_PROXY_REQUEST",Q=y({[b]:v(),payload:h()}),U=d(Q,(e,r)=>({[b]:e,payload:r})),m="RPC_PROXY_RESPONSE",X=d(y({[m]:v(),payload:h()}),(e,r)=>({[m]:e[b],payload:r})),R="RPC_PROXY_ERROR",Y=d(y({[R]:v(),error:h()}),(e,r)=>({[R]:e[b],error:r})),S="RPC_PROXY_RPC_REQUEST",A=d(y({[S]:_(),topics:E(w()),args:E(P())}),(e,r)=>({[S]:!0,topics:e,args:r}));function F(e){return typeof e=="object"&&typeof e?.postMessage=="function"&&typeof e?.closed=="boolean"}function H(e){return F(e)?(r,t)=>e.postMessage(r,"*",t):(r,t)=>e.postMessage(r,t)}function L(e,r,t={}){const s=H(e);e.addEventListener("message",async n=>{const u=n.data;if(U.validate(u))try{const a=await r(u);s(X.create(u,a))}catch(a){s(Y.create(u,a))}},t),"start"in e&&e.start?.()}function W(e,{to:r=self,signal:t}={}){L(r,s=>{if(A.validate(s.payload))try{const{topics:n,args:u}=s.payload;return I(e,n,u)}catch(n){console.error("Error while processing rpc request:",n,s.payload,e)}},{signal:t})}const $={greet(e){return`Hello, ${e}!`},add(e,r){return e+r},multiply(e,r){return e*r},async fetchData(e){return await new Promise(r=>setTimeout(r,500)),{url:e,timestamp:Date.now(),data:"Fetched data from worker"}},math:{square(e){return e*e},factorial(e){return e<=1?1:e*$.math.factorial(e-1)}},slowOperation(e){return new Promise(r=>{setTimeout(()=>r(`Completed after ${e}ms`),e)})}};W($);
